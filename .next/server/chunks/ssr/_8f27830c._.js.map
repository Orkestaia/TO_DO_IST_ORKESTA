{"version":3,"sources":["../../../../src/actions/tasks.ts","../../../../.next-internal/server/app/project/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29","../../../../src/actions/kanban.ts"],"sourcesContent":["'use server'\r\n\r\nimport { prisma } from '@/lib/prisma'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\nexport async function getTodayTasks() {\r\n    const now = new Date()\r\n    const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate())\r\n    const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1)\r\n\r\n    // Fetch tasks that are:\r\n    // 1. Due today or before (overdue)\r\n    // 2. OR In Progress (if we want to show all WIP in today)\r\n    // 3. AND not done (unless we want to show completed today?) -> Usually we show completed today logic separately or filtered.\r\n\r\n    // Let's get active tasks for now.\r\n    const tasks = await prisma.task.findMany({\r\n        where: {\r\n            status: { not: 'done' },\r\n            OR: [\r\n                { dueDate: { lte: endOfDay } },\r\n                { status: 'in_progress' }\r\n            ]\r\n        },\r\n        include: {\r\n            project: true\r\n        },\r\n        orderBy: [\r\n            { priority: 'asc' }, // P1, P2...\r\n            { dueDate: 'asc' }\r\n        ]\r\n    })\r\n\r\n    return tasks\r\n}\r\n\r\nexport async function toggleTaskStatus(id: string, currentStatus: string) {\r\n    const newStatus = currentStatus === 'done' ? 'backlog' : 'done' // Simplification\r\n    // If setting to done, set completedAt\r\n    const data: any = { status: newStatus }\r\n    if (newStatus === 'done') {\r\n        data.completedAt = new Date()\r\n    } else {\r\n        data.completedAt = null\r\n    }\r\n\r\n    await prisma.task.update({\r\n        where: { id },\r\n        data\r\n    })\r\n\r\n    revalidatePath('/')\r\n}\r\n","export {getProjectsConfig as '009f2efe35c6bb3be99d405c8ec69f61ce0664efac'} from 'ACTIONS_MODULE0'\nexport {toggleTaskStatus as '606fcb80ad4759892f4ecf56ed6ddbb6e4f2b44383'} from 'ACTIONS_MODULE1'\nexport {moveTask as '70db91f896c794b8afd92ddae4b39327ec72fad328'} from 'ACTIONS_MODULE2'\n","'use server'\r\n\r\nimport { prisma } from '@/lib/prisma'\r\nimport { revalidatePath } from 'next/cache'\r\n\r\nexport async function moveTask(taskId: string, newStatus: string, projectId: string) {\r\n    // Check WIP limit if moving to 'in_progress'\r\n    if (newStatus === 'in_progress') {\r\n        const project = await prisma.project.findUnique({\r\n            where: { id: projectId },\r\n            include: { tasks: { where: { status: 'in_progress' } } }\r\n        })\r\n\r\n        // Check global settings limit? Prompt says \"Configurar WIP limit global (default 5) y por cliente\"\r\n        // For now check Project limit\r\n        const limit = project?.wipLimit || 5\r\n        if (project && project.tasks.length >= limit) {\r\n            // Return error or handle it. Server actions can return values.\r\n            return { success: false, error: 'WIP Limit Reached' }\r\n        }\r\n    }\r\n\r\n    await prisma.task.update({\r\n        where: { id: taskId },\r\n        data: {\r\n            status: newStatus,\r\n            completedAt: newStatus === 'done' ? new Date() : null\r\n        }\r\n    })\r\n\r\n    revalidatePath(`/project/${projectId}`)\r\n    return { success: true }\r\n}\r\n"],"names":[],"mappings":"wDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,IAClB,IAAM,EAAM,IAAI,KACY,EAAI,WAAW,GAAI,EAAI,QAAQ,GAAI,EAAI,OAAO,GAC1E,IAAM,EAAW,IAAI,KAAK,EAAI,WAAW,GAAI,EAAI,QAAQ,GAAI,EAAI,OAAO,GAAK,GAyB7E,OAjBc,AAiBP,MAjBa,EAAA,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CACrC,MAAO,CACH,OAAQ,CAAE,IAAK,MAAO,EACtB,GAAI,CACA,CAAE,QAAS,CAAE,IAAK,CAAS,CAAE,EAC7B,CAAE,OAAQ,aAAc,EAC3B,AACL,EACA,QAAS,CACL,SAAS,CACb,EACA,QAAS,CACL,CAAE,SAAU,KAAM,EAClB,CAAE,QAAS,KAAM,EACpB,AACL,EAGJ,CAEO,eAAe,EAAiB,CAAU,CAAE,CAAqB,EACpE,IAAM,EAA8B,SAAlB,EAA2B,UAAY,OAAO,AAE1D,EAAY,CAAE,OAAQ,CAAU,CAClC,CAAc,IAH+D,IAGvD,GACtB,EAAK,WAAW,CAAG,IAAI,KAEvB,EAAK,WAAW,CAAG,KAGvB,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CACrB,MAAO,IAAE,CAAG,OACZ,CACJ,GAEA,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,IACnB,0CA/CsB,EA+BA,IA/BA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA+BA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,oFCpCtB,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,oBCCA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAS,CAAc,CAAE,CAAiB,CAAE,CAAiB,EAE/E,GAAkB,gBAAd,EAA6B,CAC7B,IAAM,EAAU,MAAM,EAAA,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAC5C,MAAO,CAAE,GAAI,CAAU,EACvB,QAAS,CAAE,MAAO,CAAE,MAAO,CAAE,OAAQ,aAAc,CAAE,CAAE,CAC3D,GAIM,EAAQ,GAAS,UAAY,EACnC,GAAI,GAAW,EAAQ,KAAK,CAAC,MAAM,EAAI,EAEnC,KAF0C,CAEnC,CAAE,SAAS,EAAO,MAAO,mBAAoB,CAE5D,CAWA,OATA,MAAM,EAAA,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CACrB,MAAO,CAAE,GAAI,CAAO,EACpB,KAAM,CACF,OAAQ,EACR,YAA2B,SAAd,EAAuB,IAAI,KAAS,IACrD,CACJ,GAEA,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,CAAC,SAAS,EAAE,EAAA,CAAW,EAC/B,CAAE,SAAS,CAAK,CAC3B,0CA3BsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA"}